# PENTRIX Railway Deployment Guide

This guide will help you deploy PENTRIX to Railway.app with all required environment variables and configurations.

---

## Prerequisites

1. **Railway Account**: Sign up at [railway.app](https://railway.app)
2. **GitHub Repository**: Your PENTRIX code should be in a GitHub repository
3. **CricketData API Key**: Get from [cricketdata.org](https://cricketdata.org) (required for match data)
4. **Database**: Railway MySQL plugin or external MySQL/TiDB database

---

## Step 1: Create New Railway Project

1. Go to [railway.app/new](https://railway.app/new)
2. Click **"Deploy from GitHub repo"**
3. Select your PENTRIX repository: `Krishnaait/pentrix-fantasy-cricket`
4. Railway will automatically detect the Node.js project

---

## Step 2: Add MySQL Database

1. In your Railway project, click **"+ New"**
2. Select **"Database" â†’ "Add MySQL"**
3. Railway will provision a MySQL database and auto-generate `DATABASE_URL`
4. The `DATABASE_URL` variable will be automatically added to your environment

---

## Step 3: Configure Environment Variables

Go to your Railway project â†’ **Variables** tab and add the following:

### Required Variables

| Variable | Value | Description |
|----------|-------|-------------|
| `NODE_ENV` | `production` | Sets the application to production mode |
| `JWT_SECRET` | `<generate-secure-random-string>` | **CRITICAL**: Secret for signing JWT tokens |
| `CRICKETDATA_API_KEY` | `<your-api-key>` | API key from cricketdata.org |
| `DATABASE_URL` | `<auto-generated>` | MySQL connection string (auto-added by Railway) |

### Generate JWT_SECRET

Run this command locally to generate a secure JWT_SECRET:

\`\`\`bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
\`\`\`

Copy the output and paste it as the `JWT_SECRET` value in Railway.

### Optional Variables (for full functionality)

| Variable | Default | Description |
|----------|---------|-------------|
| `PORT` | `3000` | Railway auto-assigns this, don't set manually |
| `VITE_APP_TITLE` | `PENTRIX` | Application title |
| `VITE_APP_LOGO` | `/logos/pentrix-logo-dark.png` | Logo path |

---

## Step 4: Configure Build & Start Commands

Railway should auto-detect these, but verify in **Settings â†’ Deploy**:

- **Build Command**: `pnpm install && pnpm build`
- **Start Command**: `pnpm start`

If not set, add them manually in the **Settings** tab.

---

## Step 5: Deploy

1. Click **"Deploy"** in Railway
2. Wait for the build to complete (3-5 minutes)
3. Railway will provide a public URL: `https://your-app.railway.app`
4. Visit the URL to verify deployment

---

## Step 6: Run Database Migrations

After first deployment, you need to push the database schema:

### Option A: Using Railway CLI (Recommended)

\`\`\`bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login

# Link to your project
railway link

# Run database migration
railway run pnpm db:push
\`\`\`

### Option B: Using Local Connection

1. Get your `DATABASE_URL` from Railway Variables
2. Run locally:

\`\`\`bash
DATABASE_URL="<your-railway-database-url>" pnpm db:push
\`\`\`

---

## Step 7: Verify Deployment

1. **Homepage**: Visit your Railway URL - should show PENTRIX homepage
2. **Matches**: Check `/matches` - should display upcoming cricket matches
3. **Database**: Try creating an account (if auth is enabled)
4. **API**: Check `/api/health` or similar endpoint

---

## Troubleshooting

### Build Fails

- **Check logs**: Railway â†’ Deployments â†’ View Logs
- **Common issues**:
  - Missing `pnpm` â†’ Railway should auto-detect, but add `"packageManager": "pnpm@9.0.0"` to package.json
  - TypeScript errors â†’ Fix locally first, then push

### Application Crashes

- **Check runtime logs**: Railway â†’ Deployments â†’ View Logs
- **Common issues**:
  - Missing `JWT_SECRET` â†’ Add in Variables
  - Database connection failed â†’ Verify `DATABASE_URL`
  - CricketData API errors â†’ Verify `CRICKETDATA_API_KEY`

### Database Connection Issues

- **SSL Required**: Ensure `DATABASE_URL` includes `?ssl={"rejectUnauthorized":true}`
- **Connection Timeout**: Railway MySQL should work automatically
- **External Database**: If using external DB, ensure it allows Railway's IP ranges

### Environment Variables Not Loading

- **Restart deployment**: After adding variables, trigger a new deployment
- **Check variable names**: Must match exactly (case-sensitive)
- **VITE_ prefix**: Frontend variables must start with `VITE_`

---

## Important Security Notes

1. **JWT_SECRET**: NEVER commit this to GitHub - only set in Railway Variables
2. **API Keys**: Keep all API keys in Railway Variables, not in code
3. **Database Credentials**: Use Railway's auto-generated `DATABASE_URL`
4. **HTTPS**: Railway provides HTTPS by default - always use it

---

## Post-Deployment Checklist

- [ ] Application loads without errors
- [ ] Matches page shows upcoming cricket matches
- [ ] Database connection working (check logs)
- [ ] All static assets loading (images, CSS, JS)
- [ ] Footer links working
- [ ] No console errors in browser dev tools
- [ ] API endpoints responding correctly

---

## Updating Your Deployment

Railway auto-deploys when you push to GitHub:

\`\`\`bash
# Make changes locally
git add .
git commit -m "Update feature"
git push origin main
\`\`\`

Railway will automatically:
1. Detect the push
2. Build the new version
3. Deploy with zero downtime

---

## Cost Estimate

Railway pricing (as of 2024):

- **Hobby Plan**: $5/month
  - 500 hours execution time
  - 512 MB RAM
  - 1 GB storage
  - Good for testing/personal projects

- **Pro Plan**: $20/month
  - Unlimited execution time
  - 8 GB RAM
  - 100 GB storage
  - Custom domains
  - Good for production

**Database**: Included in plan, no extra cost for MySQL plugin.

---

## Support & Resources

- **Railway Docs**: https://docs.railway.app
- **Railway Discord**: https://discord.gg/railway
- **PENTRIX GitHub**: https://github.com/Krishnaait/pentrix-fantasy-cricket
- **CricketData Docs**: https://cricketdata.org/docs

---

## Quick Reference: All Environment Variables

\`\`\`bash
# Required
NODE_ENV=production
JWT_SECRET=<your-secure-random-string>
CRICKETDATA_API_KEY=<your-api-key>
DATABASE_URL=<auto-generated-by-railway>

# Optional
VITE_APP_TITLE=PENTRIX
VITE_APP_LOGO=/logos/pentrix-logo-dark.png
\`\`\`

---

**Ready to deploy?** Follow the steps above and your PENTRIX fantasy cricket platform will be live in minutes! ðŸš€
